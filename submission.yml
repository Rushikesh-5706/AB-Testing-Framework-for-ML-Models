setup:
  - echo "Building Docker images..."
  - docker-compose build

deploy:
  - echo "Starting services with Docker Compose..."
  - docker-compose up -d
  - echo "Waiting for API health check (up to 60s)..."
  - sleep 15
  - echo "Verifying API health..."
  - curl -sf http://localhost:8000/health | python3 -m json.tool

test:
  - echo "Running automated test suite inside container..."
  - docker-compose exec api pytest tests/ -v --tb=short
  - echo "All tests passed."

analyze:
  - echo "Simulating 500 requests to the API..."
  - docker-compose exec api python scripts/simulate_traffic.py --num-requests 500 --delay-ms 5
  - echo "Running analysis pipeline..."
  - docker-compose exec api python analysis/run_analysis.py
  - echo "Analysis complete. Results saved to analysis/results.json"
  - echo "Dashboard live at: http://localhost:8501"
  - curl -sf http://localhost:8501 > /dev/null && echo "Dashboard is UP" || echo "Dashboard starting..."
